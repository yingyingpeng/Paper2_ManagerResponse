### **1. 背景概述**

目标是衡量**内容（Content）**和**评论（Comment）**在主题分布上的相似性和不同之处。这通过以下两个指标实现：

- **一致性（Consistency）**：衡量内容和评论在主题分布上的相似程度。
- **差异性（Difference）**：衡量评论相对于内容在主题分布上的不同之处。

### **2. 一致性与差异性的定义与公式**

#### **2.1. 一致性（Consistency）**

**定义**：一致性衡量内容和评论在各个主题上的概率分布有多相似。使用**加权余弦相似度**来计算这种相似性，其中各主题的权重反映其重要性。

**公式**：
$$
\text{Consistency} = \frac{\sum_{t=1}^{T} w_t \cdot \theta_{\text{Content}}(t) \cdot \theta_{\text{Comment}}(t)}{\sqrt{\sum_{t=1}^{T} w_t \cdot \theta_{\text{Content}}(t)^2} \times \sqrt{\sum_{t=1}^{T} w_t \cdot \theta_{\text{Comment}}(t)^2}}
$$

**解释**：

- **$ T $**：主题总数。
- **$ w_t $**：第 $ t $ 个主题的权重，反映该主题在一致性计算中的重要性。
- **$ \theta_{\text{Content}}(t) $**：内容在第 $ t $ 个主题上的概率。
- **$ \theta_{\text{Comment}}(t) $**：评论在第 $ t $ 个主题上的概率。

**步骤**：

1. **加权点积**：计算内容和评论在各主题上的加权乘积并求和。
2. **加权范数**：分别计算内容和评论在各主题上的加权平方和的平方根。
3. **归一化**：将加权点积除以两个加权范数的乘积，得到余弦相似度。

**范围**：$$ 0 \leq \text{Consistency} \leq 1 $$

- **1** 表示完全一致。
- **0** 表示完全不一致。

---

#### **2.2. 差异性（Difference）**

**定义**：差异性衡量评论相对于内容在主题分布上的增加部分。使用**加权差异的L2范数**来量化这种差异。

**公式**：

$$
\text{Difference} = \sqrt{\sum_{t=1}^{T} \left(w_t \cdot \max\left(\theta_{\text{Comment}}(t) - \theta_{\text{Content}}(t), 0\right)\right)^2}
$$

**解释**：

- **$ \Delta \theta(t) = \theta_{\text{Comment}}(t) - \theta_{\text{Content}}(t) $**：评论相对于内容在第 $ t $ 个主题上的概率差异。
- **$ \max(\Delta \theta(t), 0) $**：仅保留评论在主题上的增加部分，忽略减少或无变化的部分。
- **$ w_t $**：第 $ t $ 个主题的权重，反映该主题在差异性计算中的重要性。

**步骤**：

1. **计算主题差异**：对于每个主题，计算评论相对于内容的概率差异。
2. **保留正差异**：仅保留那些评论在主题上概率高于内容的部分。
3. **加权差异**：将正差异乘以对应的主题权重。
4. **L2范数**：对加权后的正差异向量计算L2范数（欧几里得距离），得到差异性指标。

**范围**：$$ 0 \leq \text{Difference} \leq \sqrt{\sum_{t=1}^{T} (w_t)^2} $$

- **0** 表示评论在所有主题上不超过内容，即无差异。
- **更大的值** 表示评论在多个主题上有显著的概率增加。

---

### **3. 总结**

通过上述数学公式，理解和验证代码中**一致性**和**差异性**的计算过程：

- **一致性**反映了内容和评论在主题分布上的相似程度，考虑了各主题的重要性。
- **差异性**量化了评论相对于内容在主题分布上的增加部分，同样考虑了主题的重要性。
